<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>役員社宅制度 総合メリットシミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        .result-card {
            transition: all 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
            max-height: 0;
            overflow: hidden;
        }
        .result-card.show {
            opacity: 1;
            transform: translateY(0);
            max-height: 3000px; /* Animate max-height */
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.5;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            padding-top: 0;
            padding-bottom: 0;
        }
        .details.show {
            max-height: 500px; /* Adjust as needed */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-slate-800 text-white py-12 px-4">
        <div class="container mx-auto text-center max-w-4xl">
            <h1 class="text-3xl md:text-4xl font-bold mb-4 leading-tight">役員社宅制度 総合メリットシミュレーター</h1>
            <p class="text-lg md:text-xl text-slate-300">お客様の状況に合わせた、2つのシミュレーターをご用意しました。</p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 space-y-16">
        
        <!-- Simulator 1: For New Adopters -->
        <section id="standard-simulator-section" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg max-w-2xl mx-auto">
            <div class="text-center mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-900">役員社宅を未導入の方向け</h2>
                <p class="text-slate-600 mt-2">個人契約の家賃を役員社宅に切り替えた場合の手残りの増加額を試算します。</p>
            </div>

            <div class="text-center text-xs text-slate-500 my-6 border-t border-b border-slate-200 py-2">
                <p>【主な前提】 法人税率: 30% / 社会保険料率: 30%（法人・個人合計） / 所得税・住民税は年収に応じた日本の標準的な税率・控除を適用して算出しています。</p>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="standard-compensation-input" class="block text-sm font-medium text-slate-700 mb-2">現在の役員報酬（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="standard-compensation-slider" min="200000" max="3000000" step="10000" value="1000000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="standard-compensation-input" value="1,000,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
                <div>
                    <label for="standard-rent-input" class="block text-sm font-medium text-slate-700 mb-2">現在の個人契約家賃（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="standard-rent-slider" min="100000" max="1000000" step="10000" value="300000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="standard-rent-input" value="300,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
                <div>
                    <label for="standard-burden-amount-input" class="block text-sm font-medium text-slate-700 mb-2">役員社宅の個人負担額（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="standard-burden-amount-slider" min="10000" max="200000" step="1000" value="50000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="standard-burden-amount-input" value="50,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button id="standard-calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition duration-300 text-lg shadow-md hover:shadow-lg">
                    手残りの増加額を計算
                </button>
            </div>
        </section>

        <section id="standard-results" class="mt-12 max-w-4xl mx-auto result-card">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-slate-900">シミュレーション結果</h3>
                <div class="text-center bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg mb-8">
                    <p class="text-lg text-slate-700">法人・個人を合わせたキャッシュフロー改善効果は...</p>
                    <p class="text-4xl md:text-5xl font-bold text-blue-600 my-4">年間 <span id="standard-total-savings">0</span> 円</p>
                </div>
                <div class="grid md:grid-cols-2 gap-6 text-center max-w-2xl mx-auto">
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-800 mb-2 tooltip">
                            ① 法人のメリット
                            <span class="tooltiptext">役員報酬の減額により、法人が負担する社会保険料が軽減されます。</span>
                        </h4>
                        <p class="text-2xl font-semibold text-green-600" id="standard-corporate-saving">0</p>
                        <p class="text-sm text-slate-500">円/年（社会保険料削減）</p>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-800 mb-2 tooltip">
                            ② 個人のメリット
                            <span class="tooltiptext">役員報酬の減額により、役員個人の社会保険料・所得税・住民税が軽減されます。</span>
                        </h4>
                        <p class="text-2xl font-semibold text-green-600" id="standard-personal-saving">0</p>
                        <p class="text-sm text-slate-500">円/年（手残り増加額）</p>
                    </div>
                </div>
                 <div class="text-right mt-2">
                    <button class="text-xs text-blue-600 hover:underline toggle-details-btn">計算の内訳</button>
                </div>
                <div class="details bg-slate-200 rounded p-4 text-xs">
                    <p id="standard-details"></p>
                </div>
                 <div class="mt-6 text-center text-sm text-slate-500">
                    <p>※役員個人の手取り額は変わらないまま、これだけの資金が創出されます。</p>
                    <p>※本シミュレーションは概算です。正確な金額は個別の状況により変動します。具体的な費用計上については、必ず顧問税理士にご確認ください。</p>
                </div>
            </div>
        </section>

        <!-- Separator -->
        <div class="py-8">
            <div class="border-t border-slate-300 max-w-sm mx-auto"></div>
        </div>

        <!-- Simulator 2: For Switchers -->
        <section id="advanced-simulator" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg max-w-2xl mx-auto">
            <div class="text-center">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-900">「社長の家探し」フル活用シミュレーター</h2>
                <p class="text-slate-600 mt-2">弊社のサービスを使うことによりどの程度メリットが生まれるのかをみてみましょう。</p>
            </div>
            
             <div class="text-center text-xs text-slate-500 my-6 max-w-2xl mx-auto border-t border-b border-slate-200 py-2">
                <p>【固定の前提】法人税率: 30% / 社会保険料率: 30% (法人15%, 個人15%) / 住民税: 東京都を想定</p>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="advanced-compensation-input" class="block text-sm font-medium text-slate-700 mb-2">現在の役員報酬（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="advanced-compensation-slider" min="200000" max="3000000" step="10000" value="1000000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="advanced-compensation-input" value="1,000,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
                <div>
                    <label for="advanced-rent-input" class="block text-sm font-medium text-slate-700 mb-2">現在の社宅家賃（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="advanced-rent-slider" min="100000" max="1000000" step="10000" value="500000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="advanced-rent-input" value="500,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
                 <hr class="my-4">
                <div>
                    <label for="service-fee-input" class="block text-sm font-medium text-slate-700 mb-2">弊社サービス料（対元家賃）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="service-fee-slider" min="0" max="50" step="1" value="20" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="service-fee-input" value="20" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">%</span>
                    </div>
                </div>
                <div>
                    <label for="key-money-input" class="block text-sm font-medium text-slate-700 mb-2">礼金（対新家賃）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="key-money-slider" min="0" max="12" step="1" value="6" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="key-money-input" value="6" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">ヶ月分</span>
                    </div>
                </div>
                <div>
                    <label for="utility-input" class="block text-sm font-medium text-slate-700 mb-2">水道光熱費（月額）</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="utility-slider" min="0" max="100000" step="1000" value="30000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <input type="text" id="utility-input" value="30,000" class="w-32 text-right bg-slate-100 rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" inputmode="numeric">
                        <span class="text-sm">円</span>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button id="advanced-calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-blue-700 transition duration-300 text-lg shadow-md hover:shadow-lg">
                    メリットを計算
                </button>
            </div>
        </section>

        <section id="advanced-results" class="mt-12 max-w-4xl mx-auto result-card">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-slate-900">シミュレーション結果</h3>
                
                <div class="text-center bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg mb-8">
                    <p class="text-lg text-slate-700">弊社のサービスに切り替えることで、新たに生まれるキャッシュフロー改善効果は...</p>
                    <p class="text-4xl md:text-5xl font-bold text-blue-600 my-4">2年間の合計 <span id="advanced-total-savings">0</span> 円</p>
                </div>

                <div class="space-y-6">
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-slate-800 mb-1 tooltip">
                                    ① 経費範囲拡大による節税効果
                                    <span class="tooltiptext">これまで個人負担だった水道光熱費や、弊社サービス料（管理料）が新たに経費として計上可能になることによる法人税の削減効果です。</span>
                                </h4>
                                <p class="text-sm text-slate-500">2年間 合計</p>
                            </div>
                            <p class="text-2xl font-semibold text-green-600" id="advanced-opex-savings">0</p>
                        </div>
                        <div class="text-right mt-2">
                            <button class="text-xs text-blue-600 hover:underline toggle-details-btn">計算の内訳</button>
                        </div>
                        <div class="details bg-slate-200 rounded p-4 text-xs">
                            <p id="advanced-opex-details"></p>
                        </div>
                    </div>

                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-slate-800 mb-1 tooltip">
                                    ② 礼金支払いによる節税効果
                                    <span class="tooltiptext">家具家電付きプラン等のために弊社にお支払いいただく礼金は、全額が法人経費となります。これにより法人税が大きく圧縮されます。</span>
                                </h4>
                                <p class="text-sm text-slate-500">2年間 合計</p>
                            </div>
                            <p class="text-2xl font-semibold text-green-600" id="advanced-key-money-corp-savings">0</p>
                        </div>
                         <div class="text-right mt-2">
                            <button class="text-xs text-blue-600 hover:underline toggle-details-btn">計算の内訳</button>
                        </div>
                        <div class="details bg-slate-200 rounded p-4 text-xs">
                            <p id="advanced-key-money-details"></p>
                        </div>
                    </div>

                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-slate-800 mb-1 tooltip">
                                    ③ 社長の可処分所得の増加効果
                                    <span class="tooltiptext">本来、礼金や水道光熱費は税金等が引かれた後の「手取り」から支払います。弊社サービスではこれらを法人が負担するため、その支払いに必要だった「税引前の役員報酬」が不要になります。その結果、個人の税・社会保険料が削減され、社長個人の手元に残るお金が増える効果です。</span>
                                </h4>
                                <p class="text-sm text-slate-500">2年間 合計</p>
                            </div>
                            <p class="text-2xl font-semibold text-green-600" id="advanced-personal-cf-savings">0</p>
                        </div>
                         <div class="text-right mt-2">
                            <button class="text-xs text-blue-600 hover:underline toggle-details-btn">計算の内訳</button>
                        </div>
                        <div class="details bg-slate-200 rounded p-4 text-xs">
                            <p id="advanced-personal-cf-details"></p>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-8 border-t-2 border-dashed">
                     <h3 class="text-xl md:text-2xl font-bold mb-6 text-center text-slate-900">費用対効果の分析</h3>
                      <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg text-center">
                         <div class="flex flex-col items-center">
                            <div class="text-lg text-slate-700">2年間のメリット合計</div>
                            <div class="text-3xl font-bold text-slate-800 my-2" id="final-total-benefit">0 円</div>
                            <div class="text-lg text-slate-700">- 2年間のコスト合計（サービス料）</div>
                            <div class="text-3xl font-bold text-red-600 my-2" id="final-total-cost">0 円</div>
                            <hr class="w-24 border-t-2 border-slate-400 my-2">
                            <div class="text-lg text-slate-700">= 2年間の純利益</div>
                            <div class="text-4xl md:text-5xl font-bold text-green-600 mt-2" id="final-net-profit">0 円</div>
                         </div>
                     </div>
                </div>

                 <div class="mt-6 text-center text-sm text-slate-500">
                    <p>※本シミュレーションは概算です。正確な金額は個別の状況により変動します。具体的な費用計上については、必ず顧問税理士にご確認ください。</p>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-slate-800 text-white mt-16 py-8">
        <div class="container mx-auto text-center text-sm">
            <p class="mb-2">株式会社グロースプロパティ</p>
            <p>本シミュレーションに関するご相談・お問い合わせは担当者までご連絡ください。</p>
        </div>
    </footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Constants and Assumptions ---
        const CORPORATE_TAX_RATE = 0.30;
        const SOCIAL_INSURANCE_RATE = 0.30;
        const SOCIAL_INSURANCE_RATE_PERSONAL = 0.15;
        const RESIDENT_TAX_RATE = 0.10;
        const BASIC_DEDUCTION = 480000;
        
        // --- Utility Functions ---
        const formatCurrency = (num) => new Intl.NumberFormat('ja-JP').format(num);
        const parseCurrency = (str) => {
            const parsed = parseFloat(String(str).replace(/,/g, ''));
            return isNaN(parsed) ? 0 : parsed;
        };
        const ceilToNearestTen = (num) => Math.ceil(num / 10) * 10;

        function syncInputs(slider, input, isCurrency = true) {
            input.value = isCurrency ? formatCurrency(slider.value) : slider.value;
        }

        function syncSlider(input, slider, isCurrency = true) {
            const value = isCurrency ? parseCurrency(input.value) : parseFloat(input.value);
            slider.value = value;
            if (isCurrency) {
               input.value = formatCurrency(value); 
            }
        }

        // --- Calculation Helper Functions (shared by both simulators) ---
        function calculateSalaryIncomeDeduction(annualIncome) {
            if (annualIncome <= 1625000) return 550000;
            if (annualIncome <= 1800000) return annualIncome * 0.4 - 100000;
            if (annualIncome <= 3600000) return annualIncome * 0.3 + 80000;
            if (annualIncome <= 6600000) return annualIncome * 0.2 + 440000;
            if (annualIncome <= 8500000) return annualIncome * 0.1 + 1100000;
            return 1950000;
        }

        function calculateIncomeTax(taxableIncome) {
            let tax = 0, deduction = 0;
            if (taxableIncome <= 1950000) { tax = taxableIncome * 0.05; deduction = 0; }
            else if (taxableIncome <= 3300000) { tax = taxableIncome * 0.10; deduction = 97500; }
            else if (taxableIncome <= 6950000) { tax = taxableIncome * 0.20; deduction = 427500; }
            else if (taxableIncome <= 9000000) { tax = taxableIncome * 0.23; deduction = 636000; }
            else if (taxableIncome <= 18000000) { tax = taxableIncome * 0.33; deduction = 1536000; }
            else if (taxableIncome <= 40000000) { tax = taxableIncome * 0.40; deduction = 2796000; }
            else { tax = taxableIncome * 0.45; deduction = 4796000; }
            const calculatedTax = tax - deduction;
            const finalTax = calculatedTax * 1.021;
            return finalTax > 0 ? finalTax : 0;
        }
        
        function calculateTaxableIncome(annualCompensation, socialInsuranceDeduction) {
            const salaryIncomeDeduction = calculateSalaryIncomeDeduction(annualCompensation);
            const taxableIncome = annualCompensation - salaryIncomeDeduction - socialInsuranceDeduction - BASIC_DEDUCTION;
            return taxableIncome > 0 ? taxableIncome : 0;
        }

        function getPersonalBurdenRate(annualCompensation) {
            const socialInsuranceDeduction = annualCompensation * SOCIAL_INSURANCE_RATE_PERSONAL;
            const salaryIncomeDeduction = calculateSalaryIncomeDeduction(annualCompensation);
            const taxableIncome = Math.max(0, annualCompensation - salaryIncomeDeduction - socialInsuranceDeduction - BASIC_DEDUCTION);
            const incomeTax = calculateIncomeTax(taxableIncome);
            const residentTax = taxableIncome * RESIDENT_TAX_RATE;
            const totalPersonalBurden = socialInsuranceDeduction + incomeTax + residentTax;
            if (annualCompensation === 0) return 0;
            return totalPersonalBurden / annualCompensation;
        }

        // --- Standard Simulator ---
        const standardCompensationSlider = document.getElementById('standard-compensation-slider');
        const standardCompensationInput = document.getElementById('standard-compensation-input');
        const standardRentSlider = document.getElementById('standard-rent-slider');
        const standardRentInput = document.getElementById('standard-rent-input');
        const standardBurdenAmountSlider = document.getElementById('standard-burden-amount-slider');
        const standardBurdenAmountInput = document.getElementById('standard-burden-amount-input');
        const standardCalculateBtn = document.getElementById('standard-calculate-btn');
        const standardResultsSection = document.getElementById('standard-results');
        const standardTotalSavingsEl = document.getElementById('standard-total-savings');
        const standardCorporateSavingEl = document.getElementById('standard-corporate-saving');
        const standardPersonalSavingEl = document.getElementById('standard-personal-saving');
        const standardDetailsEl = document.getElementById('standard-details');
        const standardToggleDetailsBtns = document.querySelectorAll('#standard-results .toggle-details-btn');

        standardCompensationSlider.addEventListener('input', () => syncInputs(standardCompensationSlider, standardCompensationInput));
        standardCompensationInput.addEventListener('change', () => syncSlider(standardCompensationInput, standardCompensationSlider));
        standardRentSlider.addEventListener('input', () => syncInputs(standardRentSlider, standardRentInput));
        standardRentInput.addEventListener('change', () => syncSlider(standardRentInput, standardRentSlider));
        standardBurdenAmountSlider.addEventListener('input', () => syncInputs(standardBurdenAmountSlider, standardBurdenAmountInput));
        standardBurdenAmountInput.addEventListener('change', () => syncSlider(standardBurdenAmountInput, standardBurdenAmountSlider));
        standardCalculateBtn.addEventListener('click', calculateStandardSavings);
        standardToggleDetailsBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const detailsDiv = e.target.parentElement.nextElementSibling;
                detailsDiv.classList.toggle('show');
            });
        });

        function calculateStandardSavings() {
            const monthlyCompensation = parseCurrency(standardCompensationInput.value);
            const monthlyRent = parseCurrency(standardRentInput.value);
            const personalBurdenAmount = parseCurrency(standardBurdenAmountInput.value);
            
            if (monthlyRent === 0) return;

            const companyRentBurden = monthlyRent - personalBurdenAmount;
            let newMonthlyCompensation = monthlyCompensation - companyRentBurden;
            if (newMonthlyCompensation < 0) newMonthlyCompensation = 0;

            const compensationReduction = monthlyCompensation - newMonthlyCompensation;
            const annualSocialInsuranceSaving = compensationReduction * 12 * SOCIAL_INSURANCE_RATE;
            
            const annualCompensationBefore = monthlyCompensation * 12;
            const annualCompensationAfter = newMonthlyCompensation * 12;
            const socialInsuranceDeductionBefore = annualCompensationBefore * (SOCIAL_INSURANCE_RATE / 2);
            const socialInsuranceDeductionAfter = annualCompensationAfter * (SOCIAL_INSURANCE_RATE / 2);
            const taxableIncomeBefore = calculateTaxableIncome(annualCompensationBefore, socialInsuranceDeductionBefore);
            const taxableIncomeAfter = calculateTaxableIncome(annualCompensationAfter, socialInsuranceDeductionAfter);
            const incomeTaxBefore = calculateIncomeTax(taxableIncomeBefore);
            const incomeTaxAfter = calculateIncomeTax(taxableIncomeAfter);
            const residentTaxBefore = taxableIncomeBefore * RESIDENT_TAX_RATE;
            const residentTaxAfter = taxableIncomeAfter * RESIDENT_TAX_RATE;
            const annualIncomeTaxSaving = (incomeTaxBefore + residentTaxBefore) - (incomeTaxAfter + residentTaxAfter);

            const corporateSaving = annualSocialInsuranceSaving / 2;
            const personalSaving = (annualSocialInsuranceSaving / 2) + annualIncomeTaxSaving;
            const totalAnnualSavings = corporateSaving + personalSaving;

            standardTotalSavingsEl.textContent = formatCurrency(ceilToNearestTen(totalAnnualSavings));
            standardCorporateSavingEl.textContent = formatCurrency(ceilToNearestTen(corporateSaving));
            standardPersonalSavingEl.textContent = formatCurrency(ceilToNearestTen(personalSaving));
            
            const effectiveIncomeTaxRate = annualCompensationBefore > 0 ? (incomeTaxBefore / annualCompensationBefore) * 100 : 0;
            const effectiveResidentTaxRate = annualCompensationBefore > 0 ? (residentTaxBefore / annualCompensationBefore) * 100 : 0;

            standardDetailsEl.innerHTML = `<strong>法人のメリット（社会保険料削減）:</strong><br>
                役員報酬削減額 ${formatCurrency(compensationReduction)}円/月 × 12ヶ月 × 法人負担率 ${SOCIAL_INSURANCE_RATE/2*100}% = ${formatCurrency(ceilToNearestTen(corporateSaving))}円<br>
                <strong class="mt-2 block">個人のメリット（社会保険料＋所得税・住民税削減）:</strong><br>
                <span class="text-xs ml-4">年収${formatCurrency(annualCompensationBefore)}円の場合、所得税実効税率は約${effectiveIncomeTaxRate.toFixed(1)}%、住民税は約${(RESIDENT_TAX_RATE*100).toFixed(1)}%です。</span><br>
                個人負担の社会保険料削減 (${formatCurrency(ceilToNearestTen(corporateSaving))}円) + 所得税・住民税削減 (${formatCurrency(ceilToNearestTen(annualIncomeTaxSaving))}円) = ${formatCurrency(ceilToNearestTen(personalSaving))}円`;


            standardResultsSection.classList.add('show');
        }

        // --- Advanced Simulator ---
        const advancedCompensationSlider = document.getElementById('advanced-compensation-slider');
        const advancedCompensationInput = document.getElementById('advanced-compensation-input');
        const advancedRentSlider = document.getElementById('advanced-rent-slider');
        const advancedRentInput = document.getElementById('advanced-rent-input');
        const serviceFeeSlider = document.getElementById('service-fee-slider');
        const serviceFeeInput = document.getElementById('service-fee-input');
        const keyMoneySlider = document.getElementById('key-money-slider');
        const keyMoneyInput = document.getElementById('key-money-input');
        const utilitySlider = document.getElementById('utility-slider');
        const utilityInput = document.getElementById('utility-input');
        const advancedCalculateBtn = document.getElementById('advanced-calculate-btn');
        const advancedResultsSection = document.getElementById('advanced-results');
        const advancedTotalSavingsEl = document.getElementById('advanced-total-savings');
        const advancedOpexSavingsEl = document.getElementById('advanced-opex-savings');
        const advancedKeyMoneyCorpSavingsEl = document.getElementById('advanced-key-money-corp-savings');
        const advancedPersonalCfSavingsEl = document.getElementById('advanced-personal-cf-savings');
        const advancedTotalCostEl = document.getElementById('advanced-total-cost');
        const advancedNetProfitEl = document.getElementById('advanced-net-profit');
        const advancedReturnOnCostEl = document.getElementById('advanced-return-on-cost');
        const advancedOpexDetailsEl = document.getElementById('advanced-opex-details');
        const advancedKeyMoneyDetailsEl = document.getElementById('advanced-key-money-details');
        const advancedPersonalCfDetailsEl = document.getElementById('advanced-personal-cf-details');
        const finalTotalBenefitEl = document.getElementById('final-total-benefit');
        const finalTotalCostEl = document.getElementById('final-total-cost');
        const finalNetProfitEl = document.getElementById('final-net-profit');
        const advancedToggleDetailsBtns = document.querySelectorAll('#advanced-results .toggle-details-btn');

        advancedCompensationSlider.addEventListener('input', () => syncInputs(advancedCompensationSlider, advancedCompensationInput));
        advancedCompensationInput.addEventListener('change', () => syncSlider(advancedCompensationInput, advancedCompensationSlider));
        advancedRentSlider.addEventListener('input', () => syncInputs(advancedRentSlider, advancedRentInput));
        advancedRentInput.addEventListener('change', () => syncSlider(advancedRentInput, advancedRentSlider));
        serviceFeeSlider.addEventListener('input', () => syncInputs(serviceFeeSlider, serviceFeeInput, false));
        serviceFeeInput.addEventListener('change', () => syncSlider(serviceFeeInput, serviceFeeSlider, false));
        keyMoneySlider.addEventListener('input', () => syncInputs(keyMoneySlider, keyMoneyInput, false));
        keyMoneyInput.addEventListener('change', () => syncSlider(keyMoneyInput, keyMoneySlider, false));
        utilitySlider.addEventListener('input', () => syncInputs(utilitySlider, utilityInput));
        utilityInput.addEventListener('change', () => syncSlider(utilityInput, utilitySlider));
        advancedCalculateBtn.addEventListener('click', calculateAdvancedSavings);
        advancedToggleDetailsBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const detailsDiv = e.target.parentElement.nextElementSibling;
                detailsDiv.classList.toggle('show');
            });
        });

        function calculateAdvancedSavings() {
            const monthlyCompensation = parseCurrency(advancedCompensationInput.value);
            const originalMonthlyRent = parseCurrency(advancedRentInput.value);
            const gpServiceFeeRate = parseFloat(serviceFeeInput.value) / 100;
            const keyMoneyMonths = parseFloat(keyMoneyInput.value);
            const utilityCostMonthly = parseCurrency(utilityInput.value);

            if (originalMonthlyRent === 0) return;

            const gpServiceFee = originalMonthlyRent * gpServiceFeeRate;
            const newTotalMonthlyRent = originalMonthlyRent + gpServiceFee + utilityCostMonthly;
            
            const twoYearNewOpex = (gpServiceFee + utilityCostMonthly) * 24;
            const twoYearOpexSavings = twoYearNewOpex * CORPORATE_TAX_RATE;
            
            const totalKeyMoney = newTotalMonthlyRent * keyMoneyMonths;
            const keyMoneyCorpSavings = totalKeyMoney * CORPORATE_TAX_RATE;

            const annualCompensation = monthlyCompensation * 12;
            const personalBurdenRate = getPersonalBurdenRate(annualCompensation);
            const grossUpFactor = 1 / (1 - personalBurdenRate);
            
            const personalBurdenUtilities = utilityCostMonthly * 24;
            const requiredGrossUtilities = personalBurdenUtilities * grossUpFactor;
            const personalCfImprovementUtilities = requiredGrossUtilities - personalBurdenUtilities;

            const personalBurdenKeyMoney = totalKeyMoney;
            const requiredGrossKeyMoney = personalBurdenKeyMoney * grossUpFactor;
            const personalCfImprovementKeyMoney = requiredGrossKeyMoney - personalBurdenKeyMoney;
            
            const totalPersonalCfImprovement = personalCfImprovementUtilities + personalCfImprovementKeyMoney;
            
            const totalTwoYearSavings = twoYearOpexSavings + keyMoneyCorpSavings + totalPersonalCfImprovement;

            const twoYearServiceFee = gpServiceFee * 24;
            const netProfit = totalTwoYearSavings - twoYearServiceFee;
            const returnOnCost = twoYearServiceFee > 0 ? totalTwoYearSavings / twoYearServiceFee : Infinity;

            advancedTotalSavingsEl.textContent = formatCurrency(ceilToNearestTen(totalTwoYearSavings));
            advancedOpexSavingsEl.textContent = formatCurrency(ceilToNearestTen(twoYearOpexSavings));
            advancedKeyMoneyCorpSavingsEl.textContent = formatCurrency(ceilToNearestTen(keyMoneyCorpSavings));
            advancedPersonalCfSavingsEl.textContent = formatCurrency(ceilToNearestTen(totalPersonalCfImprovement));
            
            finalTotalBenefitEl.textContent = formatCurrency(ceilToNearestTen(totalTwoYearSavings)) + " 円";
            finalTotalCostEl.textContent = formatCurrency(ceilToNearestTen(twoYearServiceFee)) + " 円";
            finalNetProfitEl.textContent = formatCurrency(ceilToNearestTen(netProfit)) + " 円";
            
            advancedOpexDetailsEl.innerHTML = `(月額サービス料 ${formatCurrency(gpServiceFee)}円 (元家賃 ${formatCurrency(originalMonthlyRent)}円 × ${gpServiceFeeRate*100}%) + 水道光熱費 ${formatCurrency(utilityCostMonthly)}円) × 24ヶ月 × 法人税率 ${CORPORATE_TAX_RATE*100}%`;
            advancedKeyMoneyDetailsEl.innerHTML = `新家賃 (元家賃 ${formatCurrency(originalMonthlyRent)}円 + サービス料 ${formatCurrency(gpServiceFee)}円 + 水道光熱費 ${formatCurrency(utilityCostMonthly)}円) = ${formatCurrency(newTotalMonthlyRent)}円<br>
                (${formatCurrency(newTotalMonthlyRent)}円 × ${keyMoneyMonths}ヶ月) × 法人税率 ${CORPORATE_TAX_RATE*100}%`;
            advancedPersonalCfDetailsEl.innerHTML = `役員報酬 ${formatCurrency(monthlyCompensation)}円 (年収 ${formatCurrency(annualCompensation)}円) の場合、個人の税・社会保険料の実効負担率は約 <strong>${(personalBurdenRate * 100).toFixed(1)}%</strong> です。<br><br>
                <strong>礼金支払いの反映分:</strong><br>
                手取りで ${formatCurrency(totalKeyMoney)}円 (新家賃 ${formatCurrency(newTotalMonthlyRent)}円 × ${keyMoneyMonths}ヶ月) を支払うには、税引前で約 <strong>${formatCurrency(ceilToNearestTen(requiredGrossKeyMoney))}円</strong> の報酬が必要です。<br>
                効果額 (差額): ${formatCurrency(ceilToNearestTen(personalCfImprovementKeyMoney))}円<br>
                <strong class="mt-2 block">水道光熱費の反映分 (2年):</strong><br>
                手取りで ${formatCurrency(personalBurdenUtilities)}円 (月額 ${formatCurrency(utilityCostMonthly)}円 × 24ヶ月) を支払うには、税引前で約 <strong>${formatCurrency(ceilToNearestTen(requiredGrossUtilities))}円</strong> の報酬が必要です。<br>
                効果額 (差額): ${formatCurrency(ceilToNearestTen(personalCfImprovementUtilities))}円`;
            
            advancedResultsSection.classList.add('show');
        }
    });
</script>
</body>
</html>
